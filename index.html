<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f4f6f9;
      color: #333;
      margin: 0;
      padding: 20px;
      font-size: 14px;
    }
    h1, h3 {
      text-align: center;
      color: #2c3e50;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .btn {
      padding: 10px 15px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn.red { background: #e74c3c; }
    .btn.green { background: #2ecc71; }
    .btn.orange { background: #f39c12; }
    input, select, button {
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 14px;
      overflow-x: auto;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background: #34495e;
      color: white;
    }
    td {
      height: 40px;
      cursor: pointer;
    }
    .status {
      display: block;
      width: 100%;
      height: 100%;
      border-radius: 4px;
      color: white;
      font-weight: 500;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .legend {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      font-size: 14px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .legend-color {
      width: 18px;
      height: 18px;
      border-radius: 4px;
    }
    .form-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
    }
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 99;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .popup {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    .hidden {
      display: none !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìÖ –ì—Ä–∞—Ñ–∏–∫ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è</h1>

    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —Ä–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
    <div style="text-align: center; margin-bottom: 20px;">
      <button onclick="openAdminLogin()" class="btn orange">üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</button>
    </div>

    <!-- –§–æ—Ä–º–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ -->
    <div style="background: #f0f7ff; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
      <h3>–£–∫–∞–∂–∏—Ç–µ —Å–≤–æ–π —Å—Ç–∞—Ç—É—Å</h3>
      <div class="form-group">
        <div>
          <label>–°–æ—Ç—Ä—É–¥–Ω–∏–∫:</label>
          <select id="batchEmployee"></select>
        </div>
        <div>
          <label>–û—Ç:</label>
          <input type="date" id="batchFrom" />
        </div>
        <div>
          <label>–î–æ:</label>
          <input type="date" id="batchTo" />
        </div>
        <div>
          <label>–°—Ç–∞—Ç—É—Å:</label>
          <select id="batchStatus">
            <option value="–û—Ñ–∏—Å">–û—Ñ–∏—Å</option>
            <option value="–£–¥–∞–ª—ë–Ω–Ω–æ">–£–¥–∞–ª—ë–Ω–Ω–æ</option>
            <option value="–û—Ç–ø—É—Å–∫">–û—Ç–ø—É—Å–∫</option>
            <option value="–ë–æ–ª—å–Ω–∏—á–Ω—ã–π">–ë–æ–ª—å–Ω–∏—á–Ω—ã–π</option>
            <option value="–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞">–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞</option>
            <option value="–û–±—É—á–µ–Ω–∏–µ">–û–±—É—á–µ–Ω–∏–µ</option>
            <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
          </select>
        </div>
        <button onclick="applyBatchStatus()" class="btn green">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
      </div>
    </div>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–æ–º -->
    <div class="form-group">
      <div>
        <label>–û—Ç:</label>
        <input type="date" id="viewFrom" />
      </div>
      <div>
        <label>–î–æ:</label>
        <input type="date" id="viewTo" />
      </div>
      <button onclick="generateSchedule()" class="btn">–ü–æ–∫–∞–∑–∞—Ç—å</button>
      <button onclick="setToday()" class="btn">–°–µ–≥–æ–¥–Ω—è</button>
      <button onclick="setOneWeekForward()" class="btn">–ù–µ–¥–µ–ª—é –≤–ø–µ—Ä—ë–¥</button>
      <button onclick="setOneMonthForward()" class="btn">–ú–µ—Å—è—Ü –≤–ø–µ—Ä—ë–¥</button>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ -->
    <table id="schedule">
      <thead><tr id="header-row"></tr></thead>
      <tbody id="schedule-body"></tbody>
    </table>

    <!-- –õ–µ–≥–µ–Ω–¥–∞ -->
    <div class="legend">
      <div class="legend-item"><div class="legend-color" style="background: #4CAF50;"></div> <span>–û—Ñ–∏—Å</span></div>
      <div class="legend-item"><div class="legend-color" style="background: #2196F3;"></div> <span>–£–¥–∞–ª—ë–Ω–Ω–æ</span></div>
      <div class="legend-item"><div class="legend-color" style="background: #FFC107;"></div> <span>–û—Ç–ø—É—Å–∫</span></div>
      <div class="legend-item"><div class="legend-color" style="background: #F44336;"></div> <span>–ë–æ–ª—å–Ω–∏—á–Ω—ã–π</span></div>
      <div class="legend-item"><div class="legend-color" style="background: #FF9800;"></div> <span>–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞</span></div>
      <div class="legend-item"><div class="legend-color" style="background: #9C27B0;"></div> <span>–û–±—É—á–µ–Ω–∏–µ</span></div>
      <div class="legend-item"><div class="legend-color" style="background: #795548;"></div> <span>–î—Ä—É–≥–æ–µ</span></div>
    </div>
  </div>

  <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ: –≤—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ -->
  <div id="loginOverlay" class="overlay hidden">
    <div class="popup">
      <h3>–í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
      <input type="password" id="adminPassword" placeholder="–ü–∞—Ä–æ–ª—å" />
      <div style="margin-top: 10px;">
        <button onclick="closeAdminLogin()" class="btn">–û—Ç–º–µ–Ω–∞</button>
        <button onclick="checkPassword()" class="btn green">–í–æ–π—Ç–∏</button>
      </div>
    </div>
  </div>

  <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏ -->
  <div id="adminOverlay" class="overlay hidden">
    <div class="popup" style="max-width: 600px;">
      <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏</h3>
      <div class="form-group">
        <input type="text" id="newEmployee" placeholder="–§–ò–û –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞" />
        <button onclick="addEmployee()" class="btn green">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      <ul id="employeeList" style="list-style: none; padding: 0;"></ul>
      <div style="text-align: center; margin-top: 20px;">
        <button onclick="closeAdminPanel()" class="btn">–ó–∞–∫—Ä—ã—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- –í—Å–ø–ª—ã–≤–∞—é—â–µ–µ –æ–∫–Ω–æ: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ -->
  <div id="editOverlay" class="overlay hidden">
    <div class="popup">
      <h3>–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å</h3>
      <select id="popupStatus">
        <option value="">‚Äî –ø—É—Å—Ç–æ ‚Äî</option>
        <option value="–û—Ñ–∏—Å">–û—Ñ–∏—Å</option>
        <option value="–£–¥–∞–ª—ë–Ω–Ω–æ">–£–¥–∞–ª—ë–Ω–Ω–æ</option>
        <option value="–û—Ç–ø—É—Å–∫">–û—Ç–ø—É—Å–∫</option>
        <option value="–ë–æ–ª—å–Ω–∏—á–Ω—ã–π">–ë–æ–ª—å–Ω–∏—á–Ω—ã–π</option>
        <option value="–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞">–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞</option>
        <option value="–û–±—É—á–µ–Ω–∏–µ">–û–±—É—á–µ–Ω–∏–µ</option>
        <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
      </select>
      <div style="margin-top: 10px;">
        <button onclick="closeEditPopup()" class="btn">–û—Ç–º–µ–Ω–∞</button>
        <button onclick="saveEdit()" class="btn green">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <script>
    // üîó –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –†–ê–ë–û–ß–ò–ô URL –∏–∑ Google Apps Script (–ø–æ—Å–ª–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è)
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyF9pZOSNceG-k-kyzRYbz9bqTPUGycIb2621ddR5MDJ7YfwvbbIiiAHnAc5SA1Zmun1Q/exec";

    // üîê –ü–∞—Ä–æ–ª—å –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    const ADMIN_PASSWORD = "master123";

    // –°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ)
    let employees = JSON.parse(localStorage.getItem("employees_v3")) || [
      "–ë–æ–±—Ä–æ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞",
      "–ë–∞–∂–∞–π–∫–∏–Ω–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–∞",
      "–®–µ–≤—Ü–æ–≤–∞ –õ—é–±–æ–≤—å",
      "–ë–∞—á—É—Ä–∏–Ω—Å–∫–∞—è –í–∞–ª–µ—Ä–∏—è",
      "–ö–æ—Å–º–∞—á–µ–≤–∞ –ö—Å–µ–Ω–∏—è",
      "–í—è–∑–∏–ª–æ–≤–∞ –ù–∞–¥–µ–∂–¥–∞"
    ];

    let editingCell = null;
    let allDates = [];
    let scheduleData = {};

    const statusColors = {
      "–û—Ñ–∏—Å": "#4CAF50",
      "–£–¥–∞–ª—ë–Ω–Ω–æ": "#2196F3",
      "–û—Ç–ø—É—Å–∫": "#FFC107",
      "–ë–æ–ª—å–Ω–∏—á–Ω—ã–π": "#F44336",
      "–ö–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞": "#FF9800",
      "–û–±—É—á–µ–Ω–∏–µ": "#9C27B0",
      "–î—Ä—É–≥–æ–µ": "#795548"
    };

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –≤ localStorage
    function saveEmployees() {
      localStorage.setItem("employees_v3", JSON.stringify(employees));
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å Google –¢–∞–±–ª–∏—Ü—ã
    async function loadScheduleFromServer() {
      try {
        const response = await fetch(GOOGLE_SCRIPT_URL);
        const json = await response.json();
        
        if (json.error) {
          console.error("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞:", json.error);
          alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: " + json.error);
          return {};
        }

        const map = {};
        if (json.data && Array.isArray(json.data)) {
          json.data.forEach(row => {
            if (row.–§–ò–û && row.–î–∞—Ç–∞ && row.–°—Ç–∞—Ç—É—Å) {
              map[`${row.–§–ò–û}_${row.–î–∞—Ç–∞}`] = row.–°—Ç–∞—Ç—É—Å;
            }
          });
        }
        return map;
      } catch (e) {
        console.error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ:", e);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ URL.");
        return {};
      }
    }

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ Google –¢–∞–±–ª–∏—Ü—É
    async function saveStatusToServer(employee, date, status) {
      const payload = { –§–ò–û: employee, –î–∞—Ç–∞: date, –°—Ç–∞—Ç—É—Å: status };
      try {
        const response = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify(payload),
          headers: { 'Content-Type': 'application/json' }
        });
        const result = await response.json();
        if (result.error) console.error("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:", result.error);
      } catch (e) {
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.");
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    async function init() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById("batchFrom").value = today;
      document.getElementById("batchTo").value = today;
      document.getElementById("viewFrom").value = today;
      document.getElementById("viewTo").value = today;

      updateEmployeeDropdown();
      scheduleData = await loadScheduleFromServer();
      generateSchedule();
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
    function updateEmployeeDropdown() {
      const select = document.getElementById("batchEmployee");
      select.innerHTML = "";
      employees.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
      });
    }

    // –í—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    function openAdminLogin() {
      document.getElementById("loginOverlay").classList.remove("hidden");
    }
    function closeAdminLogin() {
      document.getElementById("loginOverlay").classList.add("hidden");
      document.getElementById("adminPassword").value = "";
    }
    function checkPassword() {
      const pwd = document.getElementById("adminPassword").value;
      if (pwd === ADMIN_PASSWORD) {
        document.getElementById("loginOverlay").classList.add("hidden");
        openAdminPanel();
      } else {
        alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
      }
    }

    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏
    function openAdminPanel() {
      const list = document.getElementById("employeeList");
      list.innerHTML = "";
      employees.forEach((name, index) => {
        const li = document.createElement("li");
        li.style.padding = "8px";
        li.style.borderBottom = "1px solid #eee";
        li.innerHTML = `
          <span>${name}</span>
          <button onclick="removeEmployee(${index})" class="btn red" style="float: right; padding: 5px 10px;">–£–¥–∞–ª–∏—Ç—å</button>
        `;
        list.appendChild(li);
      });
      document.getElementById("adminOverlay").classList.remove("hidden");
    }
    function closeAdminPanel() {
      document.getElementById("adminOverlay").classList.add("hidden");
      updateEmployeeDropdown();
      generateSchedule();
    }
    function addEmployee() {
      const input = document.getElementById("newEmployee");
      const name = input.value.trim();
      if (!name) {
        alert("–í–≤–µ–¥–∏—Ç–µ –§–ò–û");
        return;
      }
      if (employees.includes(name)) {
        alert("–¢–∞–∫–æ–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–∂–µ –µ—Å—Ç—å");
        return;
      }
      employees.push(name);
      saveEmployees();
      input.value = "";
      openAdminPanel();
    }
    function removeEmployee(index) {
      if (confirm(`–£–¥–∞–ª–∏—Ç—å ${employees[index]}?`)) {
        employees.splice(index, 1);
        saveEmployees();
        openAdminPanel();
      }
    }

    // –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
    async function applyBatchStatus() {
      const emp = document.getElementById("batchEmployee").value;
      const from = document.getElementById("batchFrom").value;
      const to = document.getElementById("batchTo").value;
      const status = document.getElementById("batchStatus").value;

      if (!from || !to || from > to) {
        alert("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—Ç—ã");
        return;
      }

      if (!confirm(`–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å "${status}" –¥–ª—è ${emp} —Å ${from} –ø–æ ${to}?`)) return;

      let current = new Date(from);
      const end = new Date(to);
      let saved = 0;

      while (current <= end) {
        const dateStr = current.toISOString().split('T')[0];
        await saveStatusToServer(emp, dateStr, status);
        scheduleData[`${emp}_${dateStr}`] = status;
        saved++;
        current.setDate(current.getDate() + 1);
      }

      alert(`–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ ${saved} –∑–∞–ø–∏—Å–µ–π. –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.`);
      generateSchedule();
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã
    function generateSchedule() {
      const from = document.getElementById("viewFrom").value;
      const to = document.getElementById("viewTo").value;
      if (!from || !to || from > to) return;

      allDates = [];
      let current = new Date(from);
      const end = new Date(to);
      while (current <= end) {
        allDates.push(current.toISOString().split('T')[0]);
        current.setDate(current.getDate() + 1);
      }

      const header = document.getElementById("header-row");
      header.innerHTML = "<th>–§–ò–û</th>";
      allDates.forEach(date => {
        const d = new Date(date);
        const day = d.getDate();
        const month = d.toLocaleString('ru', { month: 'short' }).slice(0, 3);
        header.innerHTML += `<th>${day}<br><small>${month}</small></th>`;
      });

      const body = document.getElementById("schedule-body");
      body.innerHTML = "";

      employees.forEach(emp => {
        let row = `<tr><td><strong>${emp}</strong></td>`;
        allDates.forEach(date => {
          const key = `${emp}_${date}`;
          const status = scheduleData[key] || "";
          const color = status ? statusColors[status] : "#e0e0e0";
          row += `<td onclick="openEdit('${key}', '${emp}', '${date}', this)" title="${emp} ‚Äî ${date}">
                    <div class="status" style="background:${color}">${status}</div>
                  </td>`;
        });
        row += "</tr>";
        body.innerHTML += row;
      });
    }

    // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –∫–ª–∏–∫—É
    function openEdit(key, emp, date, cell) {
      editingCell = { key, emp, date, cell };
      document.getElementById("popupStatus").value = scheduleData[key] || "";
      document.getElementById("editOverlay").classList.remove("hidden");
    }
    function closeEditPopup() {
      document.getElementById("editOverlay").classList.add("hidden");
    }
    async function saveEdit() {
      const status = document.getElementById("popupStatus").value;
      const { emp, date, cell } = editingCell;

      if (status) {
        await saveStatusToServer(emp, date, status);
        scheduleData[`${emp}_${date}`] = status;
      } else {
        delete scheduleData[`${emp}_${date}`];
        await saveStatusToServer(emp, date, "");
      }

      const div = cell.querySelector(".status");
      div.textContent = status;
      div.style.background = status ? statusColors[status] : "#e0e0e0";

      closeEditPopup();
    }

    // –ë—ã—Å—Ç—Ä—ã–µ –ø–µ—Ä–∏–æ–¥—ã
    function setToday() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById("viewFrom").value = today;
      document.getElementById("viewTo").value = today;
      generateSchedule();
    }
    function setOneWeekForward() {
      const today = new Date();
      const nextWeek = new Date(today);
      nextWeek.setDate(today.getDate() + 6);
      document.getElementById("viewFrom").value = today.toISOString().split('T')[0];
      document.getElementById("viewTo").value = nextWeek.toISOString().split('T')[0];
      generateSchedule();
    }
    function setOneMonthForward() {
      const today = new Date();
      const nextMonth = new Date(today);
      nextMonth.setDate(today.getDate() + 30);
      document.getElementById("viewFrom").value = today.toISOString().split('T')[0];
      document.getElementById("viewTo").value = nextMonth.toISOString().split('T')[0];
      generateSchedule();
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
    window.onload = init;
  </script>
</body>

</html>



